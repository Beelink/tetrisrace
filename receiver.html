<!DOCTYPE html>
<html> 
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>Receiver</title>
        <script src="/socket.io/socket.io.js"></script>
        <style>
            body {
                background-color: lightgray;
            }

            .container {
                width: 800px;
                margin: 16px;
				border: 6px solid black;
				background-color: white;
                border-radius: 32px;
                text-align: center;
                width: calc(100% - 32px);
            }

            canvas {
                margin: 16px;
				border: 6px solid black;
				background-color: white;
                border-radius: 32px;
                width: calc(100% - 36px);
            }

            span {
                font-weight: bold;
                font-family: Helvetica;
                font-size: 5vw;
                display: inline-block;
                margin: 16px;
            }
        </style>
    </head>
    <body> 
        <div class="container">
            <span id="score_value"></span>
            <span id="dificulty_value"></span>
            <span id="complexity_value">ðŸ’š Easy</span>
        </div>
        <canvas id="div_canvas" width="800" height="300"></canvas>
        <script>    
            var socket = io('http://localhost:8080');

            let g = null;
                
            socket.on('send-message', function (data) {
                switch(data['message']) {
                case "left": g.left();
                    break;
                case "right": g.right();
                    break;
                case "up": g.up();
                    break;
                case "down": g.down();
                    break;
                case "restart": restart();
                    break;
                case "complexity": changeTypeDifficulty();
                    break;
                }
            });

            function HardBlock() {

            }
    
            function EasyBlock(x, y, width, height, game) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.color = "black"
    
                this.draw = function() {
                    this.x -= game.dificulty;

                    game.ctx.beginPath();
                    game.ctx.fillStyle = "rgb(0, 0, 0)";
                    game.ctx.fillRect(this.x, this.y, this.width, this.height);
                    game.ctx.closePath();
                }
            }

            function MainCharacter(game) {
                this.x = 0;
                this.y = Math.floor((game.height) / 2);
                this.width = 100;
                this.height = 50;
                this.targetX = this.x;
                this.targetY = this.y;
                
                this.draw = function() {
                    if(this.x < this.targetX) {
                        this.x += 10;
                    }
                    if(this.x > this.targetX) {
                        this.x -= 10;
                    }
                    if(this.y < this.targetY) {
                        this.y += 10;
                    }
                    if(this.y > this.targetY) {
                        this.y -= 10;
                    }

                    game.ctx.beginPath();
                    game.ctx.fillStyle = "rgb(0, 0, 0)";;
                    game.ctx.fillRect(this.x, this.y, this.width, this.height);
                    game.ctx.closePath();
                }
    
                this.right = function() {
                    if(this.targetX + this.width < game.width) {
                        this.targetX += 50;
                    }
                }
    
                this.left = function() {
                    if(this.targetX > 0) {
                        this.targetX += -50;
                    }
                }
    
                this.down = function() {
                    if(this.targetY + this.height < game.height) {
                        this.targetY += 50;
                    }
                }
    
                this.up = function() {
                    if(this.targetY > 0) {
                        this.targetY += -50;
                    }
                }
            }
    
            function Game(canvas, scoreText, dificultyText, complexityText) {
                this.ctx = canvas.getContext("2d");
                this.height = canvas.height;
                this.width = canvas.width;
                this.play = true;
                this.easy_complexity = true;
                this.mainCharacter = new MainCharacter(this);
                this.blocks = [];
                this.score = 0;
                this.dificulty = 1;

                this.left = function() {
                    this.mainCharacter.left();
                }

                this.right = function() {
                    this.mainCharacter.right();
                }

                this.up = function() {
                    this.mainCharacter.up();
                }

                this.down = function() {
                    this.mainCharacter.down();
                }
    
                this.loop = function() {
                    if(this.play) {
                        this.ctx.fillStyle = "rgb(255, 255, 255)";
                        this.ctx.fillRect(0, 0, this.width, this.height);
                        this.mainCharacter.draw();
                        for(let i = 0; i < this.blocks.length; i++) { 
                            if(this.blocks[i].y == this.mainCharacter.y) {
                                if(this.blocks[i].x < this.mainCharacter.x + this.mainCharacter.width && this.blocks[i].x + this.blocks[i].width > this.mainCharacter.x) {
                                    this.play = false;
                                }
                            }
                            this.blocks[i].draw();
                        }
                        this.score++;
                        scoreText.innerHTML = "ðŸ’¯ " + this.score;

                        this.dificulty += 0.001;
                        dificultyText.innerHTML = "âš¡ x" + Math.round(this.dificulty * 100) / 100;
                    } else {
                        scoreText.innerHTML = "ðŸ’¥ " + this.score; 
                                
                        this.ctx.fillStyle = "rgb(184, 63, 72)";
                        this.ctx.fillRect(0, 0, this.width, this.height);
                    }
                }

                this.createEasyBlock = function() {
                    let random = 50 * getRandomInt(1, 6);
                    this.blocks.push(new EasyBlock(this.width, random, 100, 50, this));
                }
            }   
    
            function getRandomInt(min, max) {
                return Math.floor(Math.random() * (max - min)) + min;
            }

            function restart() {
                location.reload();
            } 

            // function changeTypeDifficulty() {
            //     if(game.easy_complexity) {
            //         game.easy_complexity = false;
            //         document.getElementById('complexity_value').innerHTML = "ðŸ˜¡ Hard";
            //     } else {
            //         game.easy_complexity = true;
            //         document.getElementById('complexity_value').innerHTML = "ðŸ’š Easy";
            //     }
            //     socket.emit('request-message', { message: "back-complexity", value: game.easy_complexity });
            // }

            window.onload = init();

            function init() {
                g = new Game(document.getElementById("div_canvas"), document.getElementById("score_value"), document.getElementById("dificulty_value"), document.getElementById("complexity_value"));
                
                setInterval(g.loop, 10);
                setInterval(g.createEasyBlock, 100);
            }
        </script>
    </body>
</html>
